<div id="content">
    {% extends "layout.html" %} {% block content %}
    <div class="container-2">
        <form
            id="changePasswordForm"
            method="POST"
            style="display: flex; gap: 10px; flex-direction: column"
        >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <div>
                <input
                    type="password"
                    id="current_password"
                    name="current_password"
                    placeholder="enter current password"
                    required
                />
            </div>
            <div>
                <input
                    type="password"
                    id="new_password"
                    name="new_password"
                    placeholder="enter new password"
                    required
                />
            </div>
            <div>
                <input
                    type="password"
                    id="confirm_password"
                    name="confirm_password"
                    placeholder="confirm new password"
                    required
                />
            </div>
            <button class="btn" type="submit">change password</button>
        </form>
    </div>
</div>
<div
    id="popup"
    style="
        display: none;
        position: fixed;
        top: 20%;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background: #fff;
        padding: 20px;
        border: 1px solid #ccc;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    "
>
    <span id="popup-message"></span>
    <br />
    <br />
    <button class="btn" onclick="hidePopup()">Close</button>
</div>

<script>
    function showPopup(message) {
        document.getElementById("popup-message").innerText = message;
        document.getElementById("popup").style.display = "block";
        document.getElementById("content").classList.add("blur");
    }

    function hidePopup() {
        document.getElementById("popup").style.display = "none";
        document.getElementById("content").classList.remove("blur");
    }

    document
        .getElementById("changePasswordForm")
        .addEventListener("submit", function (e) {
            e.preventDefault();

            fetch("{{ url_for('change_password') }}", {
                method: "POST",
                body: new FormData(this),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        showPopup("password changed successfully!");
                        setTimeout(() => {
                            window.location.href = data.redirect_url;
                        }, 1500);
                    } else {
                        showPopup(data.error);
                    }
                })
                .catch((error) => {
                    showPopup("an unexpected error occurred!");
                    console.error("Error:", error);
                });
        });
</script>
{% endblock %}
